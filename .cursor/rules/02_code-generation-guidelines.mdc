# Code Generation Guidelines

**Version**: 1.0  
**Last Updated**: January 2026

---

## React Component Patterns

### Functional Components with TypeScript

Always use functional components with TypeScript:

```typescript
import { useState, useEffect } from 'react';
import type { Client } from '../types';

interface ClientsProps {
  initialClients?: Client[];
  onClientSelect?: (client: Client) => void;
}

export function Clients({ initialClients, onClientSelect }: ClientsProps) {
  const [clients, setClients] = useState<Client[]>(initialClients || []);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    // Component logic
  }, []);

  return (
    <div className="clients-container">
      {/* Component JSX */}
    </div>
  );
}
```

### Custom Hooks Pattern

Extract reusable logic into custom hooks:

```typescript
// useClients.ts
import { useState, useEffect } from 'react';
import { clientService } from '../services/api';
import type { Client } from '../types';

export function useClients() {
  const [clients, setClients] = useState<Client[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    async function fetchClients() {
      try {
        setLoading(true);
        const data = await clientService.getClients();
        setClients(data);
      } catch (err) {
        setError(err instanceof Error ? err.message : 'Failed to fetch clients');
      } finally {
        setLoading(false);
      }
    }

    fetchClients();
  }, []);

  return { clients, loading, error, refetch: () => fetchClients() };
}
```

---

## Service Layer Pattern

### API Service Structure

```typescript
// services/api.ts
import type { Client, Task, User } from '../types';

// Simulated API delay for development
const delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));

export const clientService = {
  async getClients(): Promise<Client[]> {
    await delay(300);
    // TODO: Replace with actual API call
    // const response = await fetch('/api/clients');
    // return response.json();
    return mockClients;
  },

  async getClientById(id: string): Promise<Client | undefined> {
    await delay(200);
    // TODO: Replace with actual API call
    return mockClients.find(c => c.id === id);
  },

  async createClient(client: Omit<Client, 'id' | 'createdAt'>): Promise<Client> {
    await delay(300);
    // TODO: Replace with actual API call
    const newClient: Client = {
      ...client,
      id: crypto.randomUUID(),
      createdAt: new Date().toISOString(),
    };
    return newClient;
  },
};
```

---

## Context API Pattern

### Auth Context Example

```typescript
// store/AuthContext.tsx
import { createContext, useContext, useState, useCallback, ReactNode } from 'react';
import { authService } from '../services/api';
import type { User, AuthState } from '../types';

const AuthContext = createContext<AuthState | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);

  const login = useCallback(async (email: string, password: string): Promise<boolean> => {
    try {
      const userData = await authService.login(email, password);
      if (userData) {
        setUser(userData);
        return true;
      }
      return false;
    } catch (error) {
      console.error('Login failed:', error);
      return false;
    }
  }, []);

  const logout = useCallback(() => {
    setUser(null);
    authService.logout();
  }, []);

  return (
    <AuthContext.Provider
      value={{
        user,
        isAuthenticated: !!user,
        login,
        logout,
      }}
    >
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

---

## DataGrid Component Usage

### DataGrid Configuration

```typescript
import { DataGrid, type Column } from '../components/common';
import type { Client } from '../types';

function Clients() {
  const [clients, setClients] = useState<Client[]>([]);

  const columns: Column<Client>[] = [
    {
      id: 'name',
      label: 'Client Name',
      accessor: 'name',
      sortable: true,
      filterable: true,
    },
    {
      id: 'pan',
      label: 'PAN',
      accessor: 'pan',
      sortable: true,
      filterable: true,
    },
    {
      id: 'status',
      label: 'Status',
      accessor: 'status',
      sortable: true,
      filterable: true,
      filterType: 'select',
      filterOptions: [
        { label: 'Active', value: 'active' },
        { label: 'Inactive', value: 'inactive' },
      ],
      render: (value) => (
        <span className={`status-badge status-${value}`}>{value}</span>
      ),
    },
    {
      id: 'nextDueDate',
      label: 'Next Due Date',
      accessor: 'nextDueDate',
      sortable: true,
      filterable: true,
      filterType: 'date',
    },
  ];

  return (
    <DataGrid
      data={clients}
      columns={columns}
      loading={loading}
      emptyMessage="No clients found"
      storageKey="clients-grid"
    />
  );
}
```

---

## TypeScript Type Definitions

### Type Organization

```typescript
// types/index.ts

// User types
export interface User {
  id: string;
  email: string;
  name: string;
  role: 'admin' | 'staff' | 'user';
}

// Client types
export interface Client {
  id: string;
  name: string;
  pan: string;
  gstin?: string;
  email: string;
  phone: string;
  status: 'active' | 'inactive';
  nextDueDate?: string;
  address?: string;
  createdAt: string;
}

// Task types
export type TaskType = 'GST' | 'ITR' | 'TDS' | 'Audit' | 'ROC' | 'Other';
export type TaskStatus = 'pending' | 'in-progress' | 'completed' | 'overdue';
export type TaskPriority = 'low' | 'medium' | 'high';

export interface Task {
  id: string;
  title: string;
  description: string;
  clientId: string;
  clientName: string;
  type: TaskType;
  status: TaskStatus;
  priority: TaskPriority;
  dueDate: string;
  assignee: string;
  createdAt: string;
}
```

---

## File Organization

```
src/CAOfficeSuite.Web/src/
├── components/
│   ├── common/              # Reusable components
│   │   ├── DataGrid.tsx
│   │   ├── DataGrid.types.ts
│   │   ├── ColumnManager.tsx
│   │   └── index.ts         # Barrel exports
│   └── layout/              # Layout components
│       ├── Layout.tsx
│       ├── Navbar.tsx
│       ├── Footer.tsx
│       └── index.ts
├── pages/                   # Page components
│   ├── Home.tsx
│   ├── Login.tsx
│   ├── Clients.tsx
│   ├── Tasks.tsx
│   ├── Help.tsx
│   └── index.ts
├── services/                # API services
│   ├── api.ts
│   └── mockData.ts
├── store/                   # State management
│   ├── AuthContext.tsx
│   └── useAuth.ts
└── types/                   # TypeScript types
    └── index.ts
```

---

## Code Generation Checklist

When generating React/TypeScript code, always:

1. **Use TypeScript**: Define proper types and interfaces
2. **Functional Components**: Use function components, not class components
3. **Hooks**: Use React hooks (useState, useEffect, useContext, etc.)
4. **Error Handling**: Handle errors gracefully with try/catch
5. **Loading States**: Show loading indicators during async operations
6. **Accessibility**: Include proper ARIA attributes where needed
7. **Responsive Design**: Ensure components work on mobile and desktop
8. **Barrel Exports**: Use index.ts files for clean imports
9. **Component Props**: Define clear prop interfaces
10. **Comments**: Add JSDoc comments for complex logic
